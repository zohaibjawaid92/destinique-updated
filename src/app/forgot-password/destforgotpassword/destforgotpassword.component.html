<div class="flow-container bg-white">
  <ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-circus" [fullScreen]="true">
    <p style="color: white">Sending reset link...</p>
  </ngx-spinner>

  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5">
        <div class="card shadow-lg border-0">
          <div class="card-header bg-gradient-primary text-white text-center py-4">
            <div class="d-flex align-items-center justify-content-center">
              <div>
                <h4 class="mb-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"  viewBox="0 0 640 640"><path d="M400 416C497.2 416 576 337.2 576 240C576 142.8 497.2 64 400 64C302.8 64 224 142.8 224 240C224 258.7 226.9 276.8 232.3 293.7L71 455C66.5 459.5 64 465.6 64 472L64 552C64 565.3 74.7 576 88 576L168 576C181.3 576 192 565.3 192 552L192 512L232 512C245.3 512 256 501.3 256 488L256 448L296 448C302.4 448 308.5 445.5 313 441L346.3 407.7C363.2 413.1 381.3 416 400 416zM440 160C462.1 160 480 177.9 480 200C480 222.1 462.1 240 440 240C417.9 240 400 222.1 400 200C400 177.9 417.9 160 440 160z"/></svg>
                    Reset Your Password</h4>
                <p class="small mb-0 opacity-75">Destinique Account Recovery</p>
              </div>
            </div>
          </div>

          <div class="card-body p-4 p-md-5">
            <!-- Success Message -->
            <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show d-flex align-items-center" role="alert">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></svg>
              <div class="flex-grow-1">
                <strong>Success!</strong>
                <div class="mt-1">{{ successMessage }}</div>
              </div>
              <button type="button" class="btn-close" (click)="successMessage = ''"></button>
            </div>

            <!-- Instructions -->
            <div class="alert alert-light border mb-4">
              <div class="d-flex">
                <div>
                  <h6 class="alert-heading mb-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/></svg>
                      How to reset your password
                  </h6>
                  <ol class="mb-0 ps-3 small">
                    <li>Enter your registered email address</li>
                    <li>Click "Send Reset Link"</li>
                    <li>Check your email for the reset instructions</li>
                    <li>Follow the link to create a new password</li>
                  </ol>
                </div>
              </div>
            </div>

            <!-- Password Reset Form -->
            <form [formGroup]="RequestResetForm" (ngSubmit)="postrequestresetdata()" autocomplete="off" novalidate>

              <!-- Email Input -->
              <div class="mb-4">
                <label for="emailOrUsername" class="form-label mb-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-envelope" viewBox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1zm13 2.383-4.708 2.825L15 11.105zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741M1 11.105l4.708-2.897L1 5.383z"/></svg>
                  Email Address
                  <span class="text-danger">*</span>
                </label>

                <div class="input-group input-group-lg">
                  <input
                    class="form-control"
                    placeholder="e-mail"
                    type="email"
                    id="emailOrUsername"
                    formControlName="emailOrUsername"
                    [ngClass]="{
                      'is-invalid': showError('emailOrUsername')
                    }"
                    [disabled]="isLoading"
                    autocomplete="email"
                    aria-describedby="emailHelp"
                  />
                </div>

                <!-- Validation Messages -->
                <div *ngIf="showError('emailOrUsername')" class="mt-2">

                  <!-- Required Error -->
                  <div *ngIf="hasError('emailOrUsername', 'required')" class="alert alert-danger py-2 small">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
                    Email address is required!
                  </div>

                  <!-- Email format Error -->
                  <div *ngIf="hasError('emailOrUsername', 'email')" class="alert alert-danger py-2 small">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
                    Please enter a valid email address!
                  </div>
                </div>

                <!-- Helper Text -->
                <div id="emailHelp" class="form-text mt-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-lightbulb" viewBox="0 0 16 16"><path d="M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a2 2 0 0 0-.453-.618A5.98 5.98 0 0 1 2 6m6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1"/></svg>
                  Enter the email address you used when creating your Destinique account.
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-3 mt-4">
                <!-- Submit Button -->
                <button
                  class="btn btn-primary btn-lg py-3"
                  type="submit"
                  [disabled]="isLoading || RequestResetForm.invalid"
                  [ngClass]="{'btn-success': successMessage}"
                >
                  <span *ngIf="!isLoading; else loading">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-send" viewBox="0 0 16 16"><path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576zm6.787-8.201L1.591 6.602l4.339 2.76z"/></svg>
                    {{ successMessage ? 'Link Sent!' : 'Send Reset Link' }}
                  </span>
                  <ng-template #loading>
                    <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                    Sending...
                  </ng-template>
                </button>

                <!-- Resend Button (only shows after success) -->
                <button
                  *ngIf="successMessage"
                  class="btn btn-outline-primary btn-lg py-3"
                  type="button"
                  (click)="resendResetLink()"
                  [disabled]="isLoading"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/></svg>
                  Resend Reset Link
                </button>
              </div>
            </form>

            <!-- Additional Help Links -->
            <div class="mt-5 pt-4 border-top">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="d-flex align-items-center text-muted">
                    <div>
                      <small class="d-block">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/><path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/></svg>
                          Remember your password?
                      </small>
                      <a href="javascript:void(0)"
                         class="text-decoration-none"
                         (click)="openLoginModal()">
                        Sign In to your account
                      </a>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="d-flex align-items-center text-muted">
                    <div>
                      <small class="d-block">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-add" viewBox="0 0 16 16"><path d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7m.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0m-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/><path d="M8.256 14a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1z"/></svg>
                          Don't have an account?
                      </small>
                      <a [routerLink]="['/register']" class="text-decoration-none">
                        Create new account
                      </a>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Support Link -->
              <div class="mt-4 text-center">
                <a href="mailto:inquiry@destinique.com" class="btn btn-link text-decoration-none">
                  Need help? Contact our support team
                </a>
              </div>
            </div>
          </div>

          <!-- Security Note -->
          <div class="card-footer bg-light text-center py-3">
            <small class="text-muted">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-shaded" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 14.933a1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56"/></svg>
              Reset links expire in 24 hours for security reasons.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

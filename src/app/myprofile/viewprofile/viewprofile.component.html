<div class="profile-main">
    <div class="container-fluid">
        <!-- Loading Spinner -->
        <ngx-spinner
          bdColor="rgba(0, 0, 0, 0.8)"
          size="medium"
          color="#fff"
          type="ball-circus"
          [fullScreen]="true"
          *ngIf="isLoading">
          <p style="color: white">{{ loadingText }}</p>
        </ngx-spinner>

        <!-- Error State -->
        <div *ngIf="hasError && !isLoading" class="row justify-content-center">
          <div class="col-md-8 col-lg-6">
            <div class="card shadow-lg border-danger">
              <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                  <i class="fas fa-exclamation-triangle me-2"></i>
                  Unable to Load Profile
                </h5>
              </div>
              <div class="card-body text-center py-5">
                <i class="fas fa-user-slash fa-4x text-danger mb-4"></i>
                <h4 class="card-title mb-3">{{ errorMessage }}</h4>
                <p class="card-text text-muted mb-4">
                  Please check your internet connection or try again later.
                </p>
                <button class="btn btn-primary" (click)="refreshProfile()">
                  <i class="fas fa-redo me-2"></i>
                  Try Again
                </button>
              </div>
            </div>
          </div>
        </div>

        <ng-container *ngIf="isProfileLoaded">
          <div class="row">
              <div class="col-12">
                  <div class="welcome-user-name">
                      Welcome &nbsp;<span class="p-user-name"><span class="first-name">{{userProfile?.firstname}}</span>&nbsp;<span class="last-name">{{userProfile?.lastname}}</span></span>
                  </div>
              </div>
          </div>
          <div class="row">
              <div class="col-12">
                  <h2 class="personal-info-head">Personal Information</h2>
              </div>
          </div>
          <div class="row">
              <div class="col-12">
                  <div class="personal-info">
                      <form class="personal-details-form" >
                          <div class="row">
                              <div class="col-12 col-sm-6 col-lg-4 items-center">
                                  <div class="user-img-con">
                                      <div class="profile-img-x">✕</div>
                                      <img loading="lazy" decoding="async" class="profile-img-up img-fluid" src="assets/uploads/users/default_user_avatar.svg" alt="Profile picture">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4 items-center flex">
                                  <input class="mt-1" type="file" accept="image/*">
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4 items-center flex">
                                  <button class="btn mt-1 p-img-up-btn">Update</button>
                              </div>
                          </div>

                          <div class="row">
                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">First Name</div>
                                      <input type="text" class="form-control" id="p-first-name" name="p-first-name" value="{{userProfile?.firstname}}">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Last Name</div>
                                      <input type="text" class="form-control" id="p-last-name" name="p-last-name" value="{{userProfile?.lastname}}">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Email</div>
                                      <input type="text" class="form-control" id="p-email" name="p-email" value="{{userProfile?.email}}">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Phone</div>
                                      <input type="text" class="form-control" id="p-phone" name="p-phone" value="{{userProfile?.mobile}}">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Address</div>
                                      <input type="text" class="form-control" id="p-address" name="p-address" value="">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">City</div>
                                      <input type="text" class="form-control" id="p-city" name="p-city" value="">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">State/Province</div>
                                      <input type="text" class="form-control" id="p-state" name="p-state" value="">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Zip/Postal Code</div>
                                      <input type="text" class="form-control" id="p-zip" name="p-zip" value="">
                                  </div>
                              </div>

                              <div class="col-12 col-sm-6 col-lg-4">
                                  <div class="p-info-box">
                                      <div class="mt-1">Country</div>
                                      <div class="mb-3">
                                          <select class="form-control" id="p-country">
                                              <option>United States</option>
                                              <option>Afghanistan</option>
                                              <option>Albania</option>
                                              <option>Algeria</option>
                                              <option>Andorra</option>
                                              <option>Angola</option>
                                              <option>Antigua and Barbuda</option>
                                              <option>Argentina</option>
                                              <option>Armenia</option>
                                              <option>Australia</option>
                                              <option>Austria</option>
                                              <option>Azerbaijan</option>
                                              <option>Bahamas</option>
                                              <option>Bahrain</option>
                                              <option>Bangladesh</option>
                                              <option>Barbados</option>
                                              <option>Belarus</option>
                                              <option>Belgium</option>
                                              <option>Belize</option>
                                              <option>Benin</option>
                                              <option>Bhutan</option>
                                              <option>Bolivia</option>
                                              <option>Bosnia and Herzegovina</option>
                                              <option>Botswana</option>
                                              <option>Brazil</option>
                                              <option>Brunei</option>
                                              <option>Bulgaria</option>
                                              <option>Burkina Faso</option>
                                              <option>Burundi</option>
                                              <option>Cabo Verde</option>
                                              <option>Cambodia</option>
                                              <option>Cameroon</option>
                                              <option>Canada</option>
                                              <option>Central African Republic</option>
                                              <option>Chad</option>
                                              <option>Chile</option>
                                              <option>China</option>
                                              <option>Colombia</option>
                                              <option>Comoros</option>
                                              <option>Congo (Congo-Brazzaville)</option>
                                              <option>Costa Rica</option>
                                              <option>Croatia</option>
                                              <option>Cuba</option>
                                              <option>Cyprus</option>
                                              <option>Czechia (Czech Republic)</option>
                                              <option>Democratic Republic of the Congo (Congo-Kinshasa)</option>
                                              <option>Denmark</option>
                                              <option>Djibouti</option>
                                              <option>Dominica</option>
                                              <option>Dominican Republic</option>
                                              <option>Ecuador</option>
                                              <option>Egypt</option>
                                              <option>El Salvador</option>
                                              <option>Equatorial Guinea</option>
                                              <option>Eritrea</option>
                                              <option>Estonia</option>
                                              <option>Eswatini</option>
                                              <option>Ethiopia</option>
                                              <option>Fiji</option>
                                              <option>Finland</option>
                                              <option>France</option>
                                              <option>Gabon</option>
                                              <option>Gambia</option>
                                              <option>Georgia</option>
                                              <option>Germany</option>
                                              <option>Ghana</option>
                                              <option>Greece</option>
                                              <option>Grenada</option>
                                              <option>Guatemala</option>
                                              <option>Guinea</option>
                                              <option>Guinea-Bissau</option>
                                              <option>Guyana</option>
                                              <option>Haiti</option>
                                              <option>Honduras</option>
                                              <option>Hungary</option>
                                              <option>Iceland</option>
                                              <option>India</option>
                                              <option>Indonesia</option>
                                              <option>Iran</option>
                                              <option>Iraq</option>
                                              <option>Ireland</option>
                                              <option>Israel</option>
                                              <option>Italy</option>
                                              <option>Ivory Coast (Côte d'Ivoire)</option>
                                              <option>Jamaica</option>
                                              <option>Japan</option>
                                              <option>Jordan</option>
                                              <option>Kazakhstan</option>
                                              <option>Kenya</option>
                                              <option>Kiribati</option>
                                              <option>Korea, North</option>
                                              <option>Korea, South</option>
                                              <option>Kuwait</option>
                                              <option>Kyrgyzstan</option>
                                              <option>Laos</option>
                                              <option>Latvia</option>
                                              <option>Lebanon</option>
                                              <option>Lesotho</option>
                                              <option>Liberia</option>
                                              <option>Libya</option>
                                              <option>Liechtenstein</option>
                                              <option>Lithuania</option>
                                              <option>Luxembourg</option>
                                              <option>Madagascar</option>
                                              <option>Malawi</option>
                                              <option>Malaysia</option>
                                              <option>Maldives</option>
                                              <option>Mali</option>
                                              <option>Malta</option>
                                              <option>Marshall Islands</option>
                                              <option>Mauritania</option>
                                              <option>Mauritius</option>
                                              <option>Mexico</option>
                                              <option>Micronesia</option>
                                              <option>Moldova</option>
                                              <option>Monaco</option>
                                              <option>Mongolia</option>
                                              <option>Montenegro</option>
                                              <option>Morocco</option>
                                              <option>Mozambique</option>
                                              <option>Myanmar (formerly Burma)</option>
                                              <option>Namibia</option>
                                              <option>Nauru</option>
                                              <option>Nepal</option>
                                              <option>Netherlands</option>
                                              <option>New Zealand</option>
                                              <option>Nicaragua</option>
                                              <option>Niger</option>
                                              <option>Nigeria</option>
                                              <option>North Macedonia (formerly Macedonia)</option>
                                              <option>Norway</option>
                                              <option>Oman</option>
                                              <option>Pakistan</option>
                                              <option>Palau</option>
                                              <option>Panama</option>
                                              <option>Papua New Guinea</option>
                                              <option>Paraguay</option>
                                              <option>Peru</option>
                                              <option>Philippines</option>
                                              <option>Poland</option>
                                              <option>Portugal</option>
                                              <option>Qatar</option>
                                              <option>Romania</option>
                                              <option>Russia</option>
                                              <option>Rwanda</option>
                                              <option>Saint Kitts and Nevis</option>
                                              <option>Saint Lucia</option>
                                              <option>Saint Vincent and the Grenadines</option>
                                              <option>Samoa</option>
                                              <option>San Marino</option>
                                              <option>Sao Tome and Principe</option>
                                              <option>Saudi Arabia</option>
                                              <option>Senegal</option>
                                              <option>Serbia</option>
                                              <option>Seychelles</option>
                                              <option>Sierra Leone</option>
                                              <option>Singapore</option>
                                              <option>Slovakia</option>
                                              <option>Slovenia</option>
                                              <option>Solomon Islands</option>
                                              <option>Somalia</option>
                                              <option>South Africa</option>
                                              <option>South Sudan</option>
                                              <option>Spain</option>
                                              <option>Sri Lanka</option>
                                              <option>Sudan</option>
                                              <option>Suriname</option>
                                              <option>Sweden</option>
                                              <option>Switzerland</option>
                                              <option>Syria</option>
                                              <option>Taiwan</option>
                                              <option>Tajikistan</option>
                                              <option>Tanzania</option>
                                              <option>Thailand</option>
                                              <option>Timor-Leste (East Timor)</option>
                                              <option>Togo</option>
                                              <option>Tonga</option>
                                              <option>Trinidad and Tobago</option>
                                              <option>Tunisia</option>
                                              <option>Turkey</option>
                                              <option>Turkmenistan</option>
                                              <option>Tuvalu</option>
                                              <option>Uganda</option>
                                              <option>Ukraine</option>
                                              <option>United Arab Emirates</option>
                                              <option>United Kingdom</option>
                                              <option>United States</option>
                                              <option>Uruguay</option>
                                              <option>Uzbekistan</option>
                                              <option>Vanuatu</option>
                                              <option>Vatican City (Holy See)</option>
                                              <option>Venezuela</option>
                                              <option>Vietnam</option>
                                              <option>Yemen</option>
                                              <option>Zambia</option>
                                              <option>Zimbabwe</option>
                                          </select>
                                      </div>
                                  </div>
                              </div>

                              <div class="row">
                                  <div class="col-12 opt-in-text-s">
                                      <label for="SMS_MMS_Consent">
                                          <div class="sms-mms-consent">
                                              <div [ngbCollapse]="isSmsConsentCollapsed" class="collapse" id="sms-mms-consent">
                                                  <input type="checkbox" id="SMS_MMS_Consent" name="SMS_MMS_Consent" value="Bike" checked><span class="fw-bold"> SMS/MMS Consent: </span>
                                                  "I agree to receive text (SMS/MMS) messages from Destinique at the number provided. Messages will primarily be one-on-one conversations related to vacation rental inquiries, property availability, and notifications about quote updates. Occasional promotional messages may also be sent. Some messages may include images or videos. We do not share mobile opt-in information with third parties unrelated to Destinique. Message & data rates may apply. Message frequency varies. Text reply STOP to cancel. Reply HELP to get help."
                                              </div>
                                              <!-- Toggle link - REPLACED -->
                                              <a href="javascript:void(0)"
                                                 class="collapsed toggle-link"
                                                 (click)="isSmsConsentCollapsed = !isSmsConsentCollapsed"
                                                 [attr.aria-expanded]="!isSmsConsentCollapsed"
                                                 aria-controls="sms-mms-consent">
                                                 {{ isSmsConsentCollapsed ? '+ Read More' : '- Read Less' }}
                                              </a>
                                          </div>
                                      </label>
                                  </div>
                              </div>
                              
                            <div class="row">
                              <div class="col-12 opt-in-text-s">
                                <label for="SMS_MMS_Consent">
                                  <div class="sms-mms-consent">
                                    <div [ngbCollapse]="isEmailConsentCollapsed" class="collapse" id="my_profile_email_consent-mms-consent">
                                      <input  (click)="$event.stopPropagation()" type="checkbox" id="Email_Consent" name="Email_Consent" value="Bike" checked><span class="fw-bold"> Email Consent: </span>
                                      "I agree to receive emails from Destinique. Email Frequency varies and will include vacation rental updates, responses to questions, quotes, booking information, exclusive travel deals, and property recommendations. I understand I can unsubscribe at any time via the unsubscribe link in any email."
                                    </div>
                                    <!-- Toggle link - REPLACED -->
                                    <a href="javascript:void(0)"
                                       class="collapsed toggle-link"
                                       (click)="isEmailConsentCollapsed = !isEmailConsentCollapsed"
                                       [attr.aria-expanded]="!isEmailConsentCollapsed"
                                       aria-controls="sms-mms-my_profile_email_consent">
                                      {{ isEmailConsentCollapsed ? '+ Read More' : '- Read Less' }}
                                    </a>
                                  </div>
                                </label>
                              </div>
                            </div>
                              <div class="row">
                                  <div class="col-12 opt-in-text-s">
                                      View our [<a class="link-primary" [routerLink]="['/terms-and-conditions']" target="_blank">Terms of Service</a>] and [<a class="link-primary" [routerLink]="['/privacypolicies']" target="_blank">Privacy Policy</a>].
                                  </div>
                              </div>

                              <hr>
                              <div class="col-12">
                                  <button disabled type=submit class="p-info-btn btn btn-secondary text-white">Save</button>
                              </div>
                          </div>
                      </form>
                  </div>
              </div>
          </div>

          <div class="row">
              <div class="col-12">
                  <h2 class="personal-info-head">Password</h2>
              </div>
          </div>

          <div class="row">
              <div class="col-12">
                  <div class="personal-info">
                      <div class="bg-white">
                          <form class="personal-details-form" >
                              <div class="row">
                                  <div class="col-12 col-sm-6 col-md-6 col-lg-4">
                                      <div class="p-info-box">
                                          <div class="mt-1">Current Password</div>
                                          <input type="password" class="form-control" id="p-current-password" name="p-current-password" value="">
                                      </div>
                                  </div>

                                  <div class="col-12 col-sm-6 col-md-6 col-lg-4">
                                      <div class="p-info-box">
                                          <div class="mt-1">New Password</div>
                                          <input type="password" class="form-control" id="p-new-password" name="p-new-password" value="">
                                      </div>
                                  </div>

                                  <div class="col-12 col-sm-6 col-md-6 col-lg-4">
                                      <div class="p-info-box">
                                          <div class="mt-1">Confirm New Password</div>
                                          <input type="password" class="form-control" id="p-confirm-new-password" name="p-confirm-new-password" value="">
                                      </div>
                                  </div>
                                  <hr>
                                  <div class="col-12">
                                      <button disabled type=submit class="p-info-btn btn btn-secondary text-white">Save</button>
                                  </div>
                              </div>
                          </form>
                      </div>
                  </div>
              </div>
          </div>
        </ng-container>
    </div>
</div>

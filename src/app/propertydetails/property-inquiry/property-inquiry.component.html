<ngx-spinner
  bdColor="rgba(0, 0, 0, 0.8)"
  size="medium"
  color="#fff"
  type="ball-circus"
  [fullScreen]="true"
  name="propertyInquirySpinner"
>
  <p id="spinner" style="color: white">Submitting your inquiry...</p>
</ngx-spinner>

<div class="modal-header">
  <h5 class="modal-title">
    Property ID - {{ inquiryBookingFormLabelData.listId }} : {{ inquiryBookingFormLabelData.formLabel }} Form
  </h5>
  <button type="button"
          class="btn-close"
          aria-label="Close"
          (click)="close()">
  </button>
</div>

<div class="modal-body">
  <form [formGroup]="inquiryForm" (ngSubmit)="submit()">

    <div class="row">

      <!-- Name -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label class="required" for="inquiryForm_name">Your name</label>
        <input type="text"
               id="inquiryForm_name"
               class="form-control"
               formControlName="name"
               [class.is-invalid]="inquiryForm.get('name')?.touched && inquiryForm.get('name')?.invalid"/>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('name')?.errors" class="invalid-feedback">
          <div *ngIf="inquiryForm.get('name')?.hasError('required')">Name is required</div>
          <div *ngIf="inquiryForm.get('name')?.hasError('maxlength')">Maximum 200 characters allowed</div>
        </div>
      </div>

      <!-- Phone -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_phone">Phone number</label>
        <input id="inquiryForm_phone" type="text" class="form-control" formControlName="phone"/>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('phone')?.hasError('maxlength')"
             class="invalid-feedback">Phone number cannot exceed 15 digits</div>
      </div>

      <!-- Email -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label class="required" for="inquiryForm_email">Email address</label>
        <input type="email"
               id="inquiryForm_email"
               class="form-control"
               formControlName="email"
               [class.is-invalid]="inquiryForm.get('email')?.touched && inquiryForm.get('email')?.invalid"/>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('email')?.errors" class="invalid-feedback">
          <div *ngIf="inquiryForm.get('email')?.hasError('required')">Email is required</div>
          <div *ngIf="inquiryForm.get('email')?.hasError('email')">Enter a valid email</div>
          <div *ngIf="inquiryForm.get('email')?.hasError('maxlength')">Maximum 200 characters allowed</div>
        </div>
      </div>

      <!-- Date Range Picker -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label class="required" for="dateRange">Check-in & Check-out</label>

        <input
          id="dateRange"
          class="form-control"
          [class.is-invalid]="inquiryFormSubmitted && inquiryForm.errors?.['dateRangeRequired']"
          placeholder="Select date range"
          readonly
          [value]="inquiryForm.get('dateRange')?.value"
          ngbDatepicker
          #dpr="ngbDatepicker"
          [firstDayOfWeek]="7"
          [displayMonths]="calendarMonths"
          [navigation]="'arrows'"
          [outsideDays]="'hidden'"
          [autoClose]="'outside'"
          (dateSelect)="onDateSelection($event)"
          (click)="!inquiryForm.get('datesNotProvided')?.value && dpr.toggle()"
          [dayTemplate]="inquiryDayTemplate"
        />
        <ng-template #inquiryDayTemplate let-date="date"
                     let-selected="selected"
                     let-disabled="disabled"
                     let-focused="focused">
          <div class="custom-day-wrapper date-fully-available"
               [class.focused]="focused"
               [class.selected]="selected"
               [class.range-edge]="isRangeEdge(date)"
               [class.in-range]="isInRange(date)"
               [class.prefilled-date]="isPrefilledDate(date)"
               [class.past-date]="isPastDate(date)"
               [class.disabled]="isPastDate(date)"
          >
               {{ date.day }}
          </div>
        </ng-template>

        <!-- Hidden form control for actual form binding -->
        <input type="hidden" formControlName="dateRange" />

        <div class="form-check mt-2">
          <input
            type="checkbox"
            class="form-check-input"
            formControlName="datesNotProvided"
            id="datesNotProvided"
          />
          <label class="form-check-label" for="datesNotProvided">
            Dates not provided
          </label>
        </div>

        <div
          *ngIf="inquiryFormSubmitted && inquiryForm.errors?.['dateRangeRequired']"
          class="invalid-feedback d-block"
        >
          Please select a check-in and check-out date range
        </div>
      </div>

      <!-- Total Budget -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_totalBudget">Total Budget</label>
        <input id="inquiryForm_totalBudget"
               type="text"
               class="form-control"
               formControlName="totalBudget"
               [class.is-invalid]="inquiryForm.get('totalBudget')?.touched && inquiryForm.get('totalBudget')?.invalid"/>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('totalBudget')?.errors" class="invalid-feedback">
          <div *ngIf="inquiryForm.get('totalBudget')?.hasError('required')">Total budget is required</div>
          <div *ngIf="inquiryForm.get('totalBudget')?.hasError('pattern')">Total budget must be a number (up to 2 decimals)</div>
          <div *ngIf="inquiryForm.get('totalBudget')?.hasError('min')">Total budget cannot be negative</div>
          <div *ngIf="inquiryForm.get('totalBudget')?.hasError('max')">Total budget exceeds the allowed limit</div>
        </div>
      </div>

      <!-- Total Guests -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_totalGuests" class="required">Total guests</label>
        <input type="number"
               id="inquiryForm_totalGuests"
               class="form-control"
               formControlName="totalGuests"
               readonly
               [class.is-invalid]="inquiryForm.get('totalGuests')?.touched && inquiryForm.get('totalGuests')?.invalid"/>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('totalGuests')?.errors" class="invalid-feedback">
          <div *ngIf="inquiryForm.get('totalGuests')?.hasError('required')">Total guests count is required</div>
          <div *ngIf="inquiryForm.get('totalGuests')?.hasError('max')">Guest count is too high</div>
        </div>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.errors?.['guestCountMismatch']" class="invalid-feedback d-block">
          Total guests must equal Adults + Kids + Babies
        </div>
      </div>

      <!-- Adults -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_adults">Adults</label>
        <input min="0" max="100" type="number" id="inquiryForm_adults" class="form-control" formControlName="adults"/>
      </div>

      <!-- Kids -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_kids">Kids 3 years and over</label>
        <input min="0" max="100" type="number" id="inquiryForm_kids" class="form-control" formControlName="kids"/>
      </div>

      <!-- Babies -->
      <div class="col-sm-12 col-md-6 col-lg-4 mb-3">
        <label for="inquiryForm_babies">Babies under 3 years</label>
        <input min="0" max="100" type="number" id="inquiryForm_babies" class="form-control" formControlName="babies"/>
      </div>

      <!-- Message -->
      <div class="col-sm-12 mb-3">
        <label for="inquiryForm_message" class="required">Message</label>
        <textarea id="inquiryForm_message"
                  rows="3"
                  class="form-control"
                  formControlName="message"
                  [class.is-invalid]="inquiryForm.get('message')?.touched && inquiryForm.get('message')?.invalid">
        </textarea>
        <div *ngIf="inquiryFormSubmitted && inquiryForm.get('message')?.errors" class="invalid-feedback">
          <div *ngIf="inquiryForm.get('message')?.hasError('required')">Message is required</div>
          <div *ngIf="inquiryForm.get('message')?.hasError('maxlength')">Maximum 2000 characters allowed</div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 opt-in-text-s">
        <label for="SMS_MMS_Consent">
          <div class="sms-mms-consent">
            <div [ngbCollapse]="isSmsConsentCollapsed" class="collapse" id="sms-mms-consent">
              <input type="checkbox" id="SMS_MMS_Consent" name="SMS_MMS_Consent" value="Bike" checked><span class="fw-bold"> SMS/MMS Consent: </span>
              "I agree to receive text (SMS/MMS) messages from Destinique at the number provided. Messages will primarily be one-on-one conversations related to vacation rental inquiries, property availability, and notifications about quote updates. Occasional promotional messages may also be sent. Some messages may include images or videos. We do not share mobile opt-in information with third parties unrelated to Destinique. Message & data rates may apply. Message frequency varies. Text reply STOP to cancel. Reply HELP to get help."
            </div>
            <!-- Toggle link - REPLACED -->
            <a href="javascript:void(0)"
               class="collapsed toggle-link"
               (click)="isSmsConsentCollapsed = !isSmsConsentCollapsed"
               [attr.aria-expanded]="!isSmsConsentCollapsed"
               aria-controls="sms-mms-consent">
              {{ isSmsConsentCollapsed ? '+ Read More' : '- Read Less' }}
            </a>
          </div>
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-12 opt-in-text-s">
        <label for="Email_Consent">
          <div class="email-consent">
            <div [ngbCollapse]="isEmailConsentCollapsed" class="collapse" id="my_profile_email_consent-mms-consent">
              <input  (click)="$event.stopPropagation()" type="checkbox" id="Email_Consent" name="Email_Consent" value="Bike" checked><span class="fw-bold"> Email Consent: </span>
              "I agree to receive emails from Destinique. Email Frequency varies and will include vacation rental updates, responses to questions, quotes, booking information, exclusive travel deals, and property recommendations. I understand I can unsubscribe at any time via the unsubscribe link in any email."
            </div>
            <!-- Toggle link - REPLACED -->
            <a href="javascript:void(0)"
               class="collapsed toggle-link"
               (click)="isEmailConsentCollapsed = !isEmailConsentCollapsed"
               [attr.aria-expanded]="!isEmailConsentCollapsed"
               aria-controls="sms-mms-my_profile_email_consent">
              {{ isEmailConsentCollapsed ? '+ Read More' : '- Read Less' }}
            </a>
          </div>
        </label>
      </div>
    </div>
    <div class="row">
      <div class="col-12 opt-in-text-s">
        View our [<a class="link-primary" [routerLink]="['/terms-and-conditions']">Terms of Service</a>] and [<a class="link-primary" [routerLink]="['/privacypolicies']">Privacy Policy</a>].
      </div>
    </div>

    <!-- Submit / Reset buttons -->
    <div class="row">
      <div class="col-12 text-center mb-3">
        <button
          type="submit"
          class="btn btn-secondary"
          [disabled]="isSubmitting || inquiryForm.invalid"
        >
          <span *ngIf="!isSubmitting">Submit</span>
          <span *ngIf="isSubmitting">
        <i class="fas fa-spinner fa-spin me-1"></i> Submitting...
      </span>
        </button>
        &nbsp;&nbsp;
        <button
          type="reset"
          class="btn btn-secondary"
          (click)="inquiryForm.reset()"
          [disabled]="isSubmitting"
        >
          Reset
        </button>
      </div>
    </div>
  </form>

  <!-- Note / Info -->
  <div class="row">
    <div class="col-12 mt-3">
      <p class="details_form_note">
        <b>PLEASE NOTE!!</b> Rates are not guaranteed until the time of
        booking. Rates can fluctuate at any time as Property Managers now
        utilize software programs that use algorithms to automatically set
        rates (based on supply/demand). For the quickest response, please
        call 850-312-5400, and a Travel Advisor will assist you with your booking.
      </p>
    </div>
  </div>
</div>

<div class="modal-footer">
  <button class="btn btn-secondary" (click)="close()">Close</button>
</div>
